/*
 dictionary.js
 Copyright (c) @year Rakuten.Inc
 Date : @compressesDate
 genreboost.js
 Copyright (c) @year Rakuten.Inc
 Date : @compressesDate
*/
(function(){if(typeof jQuery=="undefined")return;jQuery.noConflict();var $=jQuery;var dictionary=function(){if(!window.searchplat)searchplat={};if(!searchplat.dictionary)searchplat.dictionary={};return searchplat.dictionary}();var plugins=function(){if(!dictionary.plugins)dictionary.plugins={};return dictionary.plugins}();var FALSE=0;var TRUE=1;var RDict=function(){};RDict.prototype={backup:"",maxIndex:0,viewEvent:null,ajaxEvent:null,functionNames:[],functions:[],rltdParents:null,function_proto:function(){},
spaceRegExp:new RegExp("^[\\s"+unescape("　")+"]+|[\\s"+unescape("　")+"]+$","g"),init:function(){var self=this;var config=self.config;if(!rdict.checkConfig(config))return false;self.baseUrl=config.attr("baseUrl");self.serviceid=config.attr("serviceid");self.encoding=config.attr("encoding")||"utf-8";self.service=config.attr("service");self.outputFormat=config.attr("outputFormat")||"js";self.exParam=config.attr("exParam")||"";self.sendFormParam=self.checkBoolNum(config.attr("sendFormParam"))||TRUE;var functionNames_=
config.attr("functionNames")||"dym,rltd";$.each(functionNames_.split(","),function(){self.functionNames.push(this)});self.searchUrl=config.attr("searchUrl");self.searchUrlPostfix=config.attr("searchUrlPostfix")||"";self.ajaxTimer=parseInt(config.attr("ajaxtimer"))*1E3||1E4;self.hitCount=1;try{self.input=self.getElemByConf("#"+config.attr("input"));self.form=self.getElemByConf("#"+config.attr("form"))}catch(e){return false}self.paramInput="q";self.paramHits="h";self.paramFunc="fnc";self.paramService=
"sv";self.paramServiceid="sid";self.paramReqid="rid";self.dictReqid=Math.floor(Math.random()*1E10);self.paramEncoding="oe";self.searchCommand="dictionary";self.paramCallback="cb";self.paramOutputFormat="of";self.submitLogCommand="submit";self.paramSelectNum="sn";self.paramSelectPosition="sp";self.paramSelectWord="sw";self.paramFormParam="fn";self.paramExParam="ex";for(var plugin in plugins){var pluginObj=plugins[plugin];if(typeof pluginObj.init==="function")pluginObj.init(config)}return true},postInit:function(){var self=
this;$.each(self.functions,function(i,hook){if(typeof hook.submitLogParent=="undefined"||hook.submitLogParent.length==0)return true;var ele=$(hook.submitLogParent);if(ele.length>0)ele.delegate(hook.submitLogSelector,"click",function(){rdict.sendsubmitlog($(this));return true})});return true},checkConfig:function(config){if(!rdict.isMatch(config.attr("baseUrl"),"^https?://.+$"))return false;if(!rdict.isInRange(config.attr("serviceid"),"1","999"))return false;var encoding=config.attr("encoding");if(encoding&&
!rdict.isMatch(encoding,"^(utf-8|euc-jp)$"))return false;if(!rdict.isMatch(config.attr("service"),"^\\w+$"))return false;var outputFormat=config.attr("outputFormat");if(outputFormat&&!rdict.isMatch(outputFormat,"^(js|jsonp)$"))return false;var sendFormParam=config.attr("sendFormParam");if(sendFormParam&&!rdict.isMatch(sendFormParam,"^[01]$"))return false;var functionNames=config.attr("functionNames");if(functionNames&&!rdict.isMatch(functionNames,"^(dym|rltd)(,dym|,rltd)?$"))return false;if(!rdict.isMatch(config.attr("searchUrl"),
"^https?://.+$"))return false;if(!rdict.isInRange(config.attr("ajaxtimer"),"1","99"))return false;if(!rdict.isMatch(config.attr("input"),"^[a-zA-Z0-9_\\-]+$"))return false;if(!rdict.isMatch(config.attr("form"),"^[a-zA-Z0-9_\\-]+$"))return false;return true},isMatch:function(value,pattern){return value&&(new RegExp(pattern)).test(value)?true:false},isInRange:function(value,min,max){value=parseInt(value);min=parseInt(min);max=parseInt(max);if(isNaN(value)||isNaN(min)||isNaN(max))return false;return min<=
value&&value<=max},getElemByConf:function(selector){var elem=$(selector);if(elem.length==0)throw"Element does not exist.";return elem},getElemsByConf:function(ids){var count=0;var idArr=$.map(ids.split(/\s*,\s*/),function(id,i){if(rdict.isMatch(id,"^[a-zA-Z0-9_\\-]+$")){count++;return"#"+id}});var elems=$(idArr.toString());if(elems.length==0||elems.length!=count)throw"Elements do not exist.";return elems},checkBoolNum:function(num){if(typeof num!="undefined"&&num.length!=0&&(num==FALSE||num==TRUE))return num;
return""},initFailure:function(){return false},createFunctionElem:function(index,name){var self=this;var hookClass="searchplat.dictionary.hooks.Hook_"+name+"_"+self.service;var baseClass="Base_"+name;var elemObj;try{$.extend(eval(baseClass+".prototype"),eval(hookClass+".prototype"));self.function_proto=eval(baseClass+".prototype");elemObj=eval("new "+baseClass+"()")}catch(e){}if(typeof elemObj=="undefined")return;elemObj.init();self.functions[index]=elemObj},search:function(){var self=this;var q=
self.input.val();if(!q||rdict.isMatch(q,"^[\\s"+unescape("　")+"]*$")){self.hide();return}q=q.replace(rdict.spaceRegExp,"");clearTimeout(self.ajaxEvent);self.ajaxEvent=setTimeout(function(){try{var u=rdict.baseUrl+"/"+rdict.searchCommand+"?"+rdict.paramService+"="+rdict.service+"&"+rdict.paramFunc+"="+"each"+"&"+rdict.paramHits+"="+rdict.hitCount+"&"+rdict.paramReqid+"="+rdict.dictReqid+"&"+rdict.paramServiceid+"="+rdict.serviceid+"&"+rdict.paramInput+"="+encodeURIComponent(q)+"&"+rdict.paramEncoding+
"="+rdict.encoding+"&"+rdict.paramOutputFormat+"="+rdict.outputFormat;for(var plugin in plugins){var newQuery;var pluginObj=plugins[plugin];if(typeof pluginObj.getAddedQuery==="function")newQuery=pluginObj.getAddedQuery();if(newQuery!=undefined)u+=newQuery}if(rdict.exParam.length!=0)u+="&"+rdict.exParam;rdict.read(u)}catch(e){return}},10)},read:function(jsonUrl){var self=this;try{self.isTimeout=false;self.reqTimer=setTimeout(function(){self.isTimeout=true;self.hide();return},self.ajaxTimer);var enc=
self.encoding;$.ajax({url:jsonUrl,cache:true,timeout:self.ajaxTimer,dataType:"jsonp",scriptCharset:enc,jsonp:rdict.paramCallback,success:function(data){rdict.show(data)}})}catch(e){throw e;}},sendsubmitlog:function(link,position){var self=this;var q=self.input.val().replace(self.spaceRegExp,"");var enc=self.encoding;var u=self.baseUrl+"/"+self.submitLogCommand+"?"+self.paramServiceid+"="+self.serviceid+"&"+self.paramService+"="+self.service+"&"+self.paramReqid+"="+self.dictReqid+"&"+self.paramSelectNum+
"="+link.attr("num")+"&"+self.paramSelectPosition+"="+position+"&"+self.paramSelectWord+"="+encodeURIComponent(link.text())+"&"+self.paramInput+"="+encodeURIComponent(q);if(self.sendFormParam==TRUE)u+="&"+self.paramFormParam+"="+encodeURIComponent(self.form.serialize());if(self.exParam.length!=0)u+="&"+self.paramExParam+"="+encodeURIComponent(self.exParam);var type="json";if($.browser.msie)type="jsonp";setTimeout(function(){return true},self.ajaxTimer);$.ajax({url:u,cache:false,timeout:self.ajaxTimer,
dataType:type,scriptCharset:enc,async:false})},show:function(data){var self=this;if(typeof data=="undefined"||typeof data[1]!="object"||data[1].length!=2||typeof data[1][0]!="object"||typeof data[1][1]!="object"){self.hide();return}if(self.isTimeout){self.hide();return}clearTimeout(self.reqTimer);$.each(self.functions,function(i,v){if(v.show(data))return false})},hide:function(){var self=this;$.each(self.functions,function(i,v){v.hide()})}};var rdict=new RDict;var Base_rltd=function(){};Base_rltd.prototype=
{openElemCss:"rsrKeyList",hideElemParentCss:"js-on",hideElemCss:"dropdown",hideListCss:"border",name:"rltd",data:null,readyState:0,init:function(){var self=this;self.readyState=0;var rltdParentId=rdict.config.attr("rltdParentId");if(!rdict.isMatch(rltdParentId,"^[a-zA-Z0-9_\\-, ]+$"))return;try{self.rltdParents=rdict.getElemsByConf(rltdParentId)}catch(e){return}self.searchUrl=rdict.searchUrl;self.searchUrlPostfix=rdict.searchUrlPostfix;var hasError=false;self.rltdParents.each(function(){var rltd=
$(this),rltdOpenElem=rltd.find("."+self.openElemCss),rltdHideElem=rltd.find("."+self.hideElemCss),rltdHideElemParent=rltd.find("."+self.hideElemParentCss);if(rltd.length!=1||rltdOpenElem.length!=1||rltdHideElem.length!=1||rltdHideElemParent.length!=1){hasError=true;return false}var count=rltd.attr("count");if(!rdict.isInRange(count,"1","30")){hasError=true;return false}count=parseInt(count);var openCount=rltd.attr("openCount");if(!rdict.isInRange(openCount,"1","30")){hasError=true;return false}openCount=
parseInt(openCount);var position=rltd.attr("position");if(!rdict.isMatch(position,"^[a-zA-Z0-9_\\-]+$")){hasError=true;return false}rltdOpenElem.append(self.getOpenElem(count,openCount));rltdHideElem.append(self.getHideElem(count,openCount));rltd.find("."+self.openElemCss+", ."+self.hideElemCss).delegate("li > a","click",function(){rdict.sendsubmitlog($(this),position);return true});rltdHideElemParent.hide();rltd.hide()});if(hasError)return;var maxCount=0;self.rltdParents.each(function(){var count=
parseInt($(this).attr("count"));if(maxCount<count)maxCount=count});rdict.hitCount=maxCount||20;self.readyState=1},getOpenElem:function(count,openCount){var elmHTML="";var elm=$("<div/>").append($("<li />").append($("<a />")));if(count<0)count=0;if(openCount<0)openCount=0;if(count<openCount)openCount=count;for(var i=0;i<openCount;i++)elmHTML+=elm.html();return elmHTML},getHideElem:function(count,openCount){var self=this;var elmHTML="";var elm=$("<div/>").append($("<li />").attr("class",self.hideListCss).append($("<a />")));
for(var i=openCount;i<count;i++)elmHTML+=elm.html();return elmHTML},isReady:function(){return this.readyState==1},parseData:function(data_){var self=this;if(typeof data_!="object"||data_==null||data_.length<2||typeof data_[1]!="object"||data_[1]==null||data_[1].length<2)return false;self.data=data_[1][1];return typeof self.data=="object"&&self.data!=null&&self.data.length!=0},getLinkUrl:function(word,link_num){var self=this;var url=self.searchUrl.replace("###WORD###",encodeURIComponent(self.unescapeHtml(word)));
url=url.replace("###LINK_NUM###",link_num);return url+self.searchUrlPostfix},getLinkWordHtml:function(word){return word},unescapeHtml:function(val){return $("<div/>").html(val).text()},show:function(data_){var self=this;if(!self.isReady())return false;if(!this.parseData(data_))return false;self.rltdParents.each(function(){var rltd=$(this),rltdOpenElem=rltd.find("."+self.openElemCss),rltdHideElem=rltd.find("."+self.hideElemCss),rltdHideElemParent=rltd.find("."+self.hideElemParentCss),rltdOpenIndex=
0,rltdHideIndex=0;var position=rltd.attr("position");rltdOpenElem.find("a").text("").attr("href","");rltdOpenElem.find("li").hide();rltdHideElem.find("a").text("").attr("href","");rltdHideElem.find("li").hide();var count=parseInt(rltd.attr("count")),openCount=parseInt(rltd.attr("openCount"));var length=self.data.length;if(length>count)length=count;for(var i=0;i<length;i++){if(self.data[i].length==0)continue;var link_num="related_"+("0"+(i+1)).slice(-2);var targetlist;var targetlink;if(i<openCount){targetlist=
$(rltdOpenElem.find("li")[rltdOpenIndex]);targetlink=targetlist.children("a");rltdOpenIndex++}else{targetlist=$(rltdHideElem.find("li")[rltdHideIndex]);targetlink=targetlist.children("a");rltdHideIndex++;if(rltdHideElemParent.is(":hidden"))rltdHideElemParent.show()}targetlink.html(self.getLinkWordHtml(self.data[i]));targetlink.attr({href:self.getLinkUrl(self.data[i],link_num),num:link_num});self.addAction(targetlist,position,link_num);targetlist.show()}rltd.show()});return true},hide:function(){this.rltdParents.hide()},
addAction:function(rltd,position,link_num){return true}};var Base_dym=function(){};Base_dym.prototype={openElemCss:"rsrDispTxtBoxIf",stubSpanCss:"dymLinkStub",name:"dym",data:null,readyState:0,init:function(){var self=this;self.readyState=0;var dymParentId=rdict.config.attr("dymParentId");if(!rdict.isMatch(dymParentId,"^[a-zA-Z0-9_\\-, ]+$"))return;try{self.dymParents=rdict.getElemsByConf(dymParentId)}catch(e){return}self.searchUrl=rdict.searchUrl;self.searchUrlPostfix=rdict.searchUrlPostfix;self.dymParents.each(function(){var dymDiv=
$(this);var dym=dymDiv.find("."+self.openElemCss);if(dym.length!=1)return true;var dymElem=dym.find("span."+self.stubSpanCss);if(dymElem.length!=1)return true;var position=dymDiv.attr("position");if(!rdict.isMatch(position,"^[a-zA-Z0-9_\\-]+$"))return true;dym.delegate("a","click",function(){rdict.sendsubmitlog($(this),position);return true});dym.hide()});self.readyState=1},isReady:function(){return this.readyState==1},parseData:function(data_){var self=this;if(typeof data_!="object"||data_==null||
data_.length<2||typeof data_[1]!="object"||data_[1]==null||data_[1].length<1)return false;self.data=data_[1][0];return typeof self.data=="object"&&self.data!=null&&self.data.length!=0},getLinkUrl:function(word,link_num){var self=this;var url=self.searchUrl.replace("###WORD###",encodeURIComponent(self.unescapeHtml(word)));url=url.replace("###LINK_NUM###",link_num);return url+self.searchUrlPostfix},getLinkWordHtml:function(word){return word},unescapeHtml:function(val){return $("<div/>").html(val).text()},
show:function(data_){var self=this;if(!self.isReady())return false;if(!self.parseData(data_))return false;if(self.data[0].length==0)return false;var dymIndex=1;self.dymParents.each(function(){var dymDiv=$(this),dym=dymDiv.find("."+self.openElemCss),dymElem=dym.find("span."+self.stubSpanCss),position=dymDiv.attr("position"),link_num="dym_"+("0"+dymIndex).slice(-2),linkText=self.getLinkWordHtml(self.data[0]),dymLink=$("<a />").html(linkText).attr("href",self.getLinkUrl(self.data[0],link_num)).attr("num",
link_num);dymElem.replaceWith(dymLink);self.addAction(dym,position,link_num);dym.show()});return true},hide:function(){this.dymParents.hide()},addAction:function(dym,position,link_num){return true}};$(document).ready(function(){rdict.config=$("#dictApiConfig");if(rdict.config.length==0)return false;if(!rdict.init())return rdict.initFailure();$.each(rdict.functionNames,function(i,v){rdict.createFunctionElem(i,v)});if(rdict.functions.length==0)return rdict.initFailure();rdict.postInit();rdict.search()})})();
(function(){if(typeof jQuery=="undefined")return;jQuery.noConflict();var $=jQuery;var plugins=function(){if(!window.searchplat)searchplat={};if(!searchplat.dictionary)searchplat.dictionary={};if(!searchplat.dictionary.plugins)searchplat.dictionary.plugins={};return searchplat.dictionary.plugins}();var GBoost=function(){};GBoost.prototype={init:function(config){var self=this;self.genreId=config.attr("genreId")},getAddedQuery:function(){var self=this;if(self.genreId==undefined||self.genreId==""||self.genreId==
"0")return"";else return"&gb="+self.genreId}};plugins.gBoost=new GBoost})();
