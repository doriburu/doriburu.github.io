/*
 R.api-1.3.4.js
 Copyright (c) 2016 Rakuten.Inc
 Date: 2016-10-12 16:26:15
*/
if(Rmodules && typeof Rmodules.define === 'function') { Rmodules.define('R.api', '1.3.4', ['R^1'], [], function(R, undefined) {
!function(a,b){a.api.ServiceIds={ICHIBA_TOP:{acc:1,aid:1},ICHIBA_ITEM:{acc:1,aid:2},ICHIBA_BASKET:{acc:1,aid:3},ICHIBA_SEARCH:{acc:1,aid:4},ICHIBA_GOLD:{acc:1,aid:5},ICHIBA_SHOP_TOP:{acc:1,aid:6},ICHIBA_PRODUCT:{acc:1,aid:41},ICHIBA_EVENT_PAGE:{acc:1,aid:43},GENRE_TOP:{acc:1,aid:57},URANAI:{acc:428,aid:1}}}(R),function(a,b){function c(b){if(b._processed)return b;var c,d,h,i,j,k,l=a.coalesce(b.imageurl,b.medium_image_url,b.image_url_80,b.image64Url,b.small_image_url),m=a.coalesce(b.shopUrl,b.shopurl,b.shop_url),n=a.coalesce(b.tax_flg,b.taxflg),o=a.coalesce(b.postage_flg,b.postageflg),p=a.coalesce(b.item_url,b.itemurlfull,b.link),q="thumbnail.image.rakuten.co.jp/@0_mall/",r="thumbnail.image.rakuten.co.jp/@0_gold/",s="tshop.r10s.jp/",t="tshop.r10s.jp/gold/";
return b.historydate&&(c=new a.Date(b.historydate)),b.score&&(d=String(b.score)),l&&(l=l.replace(f,"").replace(e,""),"?"===l.charAt(l.length-1)&&(l=l.substring(0,l.length-1)),-1!==l.indexOf(q)?k=l.replace(q,s):-1!==l.indexOf(r)&&(k=l.replace(r,t))),n=b.price?!1:a.isString(n)?"1"===n:!!n,o=a.isString(o)?"1"===o:!!o,j=g.exec(m),j&&(m=j[1]),!m&&p&&(m=p.replace(/^https?:\/\//,"").split("/")[1]),b.pcPointRate&&(h=parseInt(b.pcPointRate,10)),b.spPointRate&&(i=parseInt(b.spPointRate,10)),{_processed:!0,
itemId:parseInt(a.coalesce(b.itemId,b.item_id,b.itemid),10),shopId:parseInt(a.coalesce(b.shopId,b.shop_id,b.shopid),10),shopName:a.coalesce(b.shopName,b.shop_name,b.shopname),shopUrl:m,itemUrlFull:p,itemName:a.coalesce(b.itemName,b.item_name,b.itemname),itemPrice:parseInt(a.coalesce(b.item_price,b.itemprice,b.price),10),includeTaxes:!n,includeShipping:!o,imageUrl:l,newImageUrl:k,reviewAverage:parseFloat(a.coalesce(b.reviewAve,b.review_average,b.reviewave)),reviewNumber:parseInt(a.coalesce(b.reviewNum,b.review_num,b.reviewnum),10),
reviewUrl:a.coalesce(b.reviewUrl,b.review_url,b.reviewurl),genreIdList:a.coalesce(b.genreidlist),historyDate:c,score:d,pcPointRate:h,spPointRate:i,rank:parseInt(b.rank,10)}}var d=a.$,e=/^https?:/,f=/_ex=\d+x\d+/,g=/rakuten.co.jp\/([^\/])\/d/,h=["jpg","png","gif","webp","jp2","jpegxr"],i={width:130,height:130,maxWidth:700,maxHeight:700,$img:b,asString:!1,maxRatio:3,srcAttr:"src",srcSetAttr:"srcset"};a.Item=function(b){b instanceof a.Item?this._data=b._data:this._data=c(b)},a.Item.prototype.getShopId=function(){
return this._data.shopId},a.Item.prototype.getShopName=function(){return this._data.shopName},a.Item.prototype.getShopUrl=function(){var a=this._data.shopUrl;return a?"//www.rakuten.co.jp/"+a+"/":b},a.Item.prototype.getShopLogoUrl=function(a,c,d,e){var f=this._data.shopUrl;return f?"//thumbnail.image.rakuten.co.jp/@0_mall/"+f+"/logo/logo"+a+(c?"n.jpg":".jpg")+(d&&e?"?_ex="+String(d)+"x"+String(e):""):b},a.Item.prototype.getItemId=function(){return this._data.itemId},a.Item.prototype.getItemUrl=function(){
return this._data.itemUrlFull},a.Item.prototype.getItemName=function(){return this._data.itemName},a.Item.prototype.getItemPrice=function(a){var c=this._data.includeTaxes,d=this._data.itemPrice;return d?a===!1?c?Math.round(d/1.08):d:c?d:Math.round(1.08*d):b},a.Item.prototype.areItemTaxesIncluded=function(){return this._data.includeTaxes},a.Item.prototype.isItemShippingIncluded=function(){return this._data.includeShipping},a.Item.prototype.getItemImageUrl=function(c,d){return this._data.imageUrl?c&&d?a.addUrlParams(this._data.imageUrl,{
_ex:String(c)+"x"+String(d)}):this._data.imageUrl:b},a.Item.prototype.getItemThumbnail=function(c,e,f){var g,i,j,k={};return this._data.newImageUrl?c&&e?(f=d.extend({},f),g=f&&f.resize?"resize":"fitin",k[g]=String(c)+":"+String(e),i=f.version?new a.Date(f.version).getNumericFormat({seconds:!1}):b,j=f.format&&-1===h.indexOf(f.format.toLowerCase())?"jpg":f.format,f.quality&&"jpg"!==f.format&&(j="jpg"),d.extend(k,{"output-quality":f.quality,"output-format":j,v:i}),decodeURIComponent(a.addUrlParams(this._data.newImageUrl,k))):this._data.newImageUrl:this.getItemImageUrl(c,e);
},a.Item.prototype.getItemImageSet=function(a){var c,e,f,g=d.extend({},i,a),h=[];if(!this.getItemImageUrl())return b;for(e=Math.min(g.maxRatio,Math.min(Math.floor(g.maxWidth/g.width),Math.floor(g.maxHeight/g.height))),c=1;e>=c;c++)h.push(this.getItemImageUrl(g.width*c,g.height*c)+" "+c+"x");return g.asString?h.join(", "):(g.$img||(f={alt:""},f[g.srcAttr]=this.getItemImageUrl(g.width,g.height),g.$img=d("<img>",f)),g.$img.attr(g.srcSetAttr,h.join(", ")),g.$img)},a.Item.prototype.getItemThumbnailSet=function(a){
var c,e,f,g=d.extend({},i,a),h=[],j={version:a.version};if(!this.getItemThumbnail())return b;for(e=Math.min(g.maxRatio,Math.min(Math.floor(g.maxWidth/g.width),Math.floor(g.maxHeight/g.height))),c=1;e>=c;c++)h.push(this.getItemThumbnail(g.width*c,g.height*c,j)+" "+c+"x");return g.asString?h.join(", "):(g.$img||(f={alt:""},f[g.srcAttr]=this.getItemThumbnail(g.width,g.height,j),g.$img=d("<img>",f)),g.$img.attr(g.srcSetAttr,h.join(", ")),g.$img)},a.Item.prototype.getItemReviewAverage=function(){return this._data.reviewAverage;
},a.Item.prototype.getItemReviewNumber=function(){return this._data.reviewNumber},a.Item.prototype.getItemReviewUrl=function(){return this._data.reviewUrl?this._data.reviewUrl||"":""},a.Item.prototype.getItemGenreIdList=function(){if(!this._data.genreIdList)return b;var a,c=this._data.genreIdList.split("/");for(a=c.length-1;a>=0;a--)c[a]=parseInt(c[a],10),isNaN(c[a])&&c.splice(a,1);return c},a.Item.prototype.getItemPointBackPercentage=function(c,d){c===b&&(c=a.browser.isMobile);var e;if(c||this._data.pcPointRate===b)if(c&&this._data.spPointRate!==b)e=this._data.spPointRate;else{
if(!this._data.score)return b;var f=c?2:0,g=this._data.score.split(".");if(g.length<2)return b;e=parseInt(g[1].substr(f,2),10)}else e=this._data.pcPointRate;return e+(d||0)},a.Item.prototype.getItemPointBackNumber=function(a,c){var d,e=this.getItemPrice();return 100>e?0:(d=this.getItemPointBackPercentage(a,c),d===b?b:Math.floor(d*e/100))},a.Item.prototype.getItemScore=function(){if(!this._data.score)return b;var a=parseInt(this._data.score.split(".")[0],10);return isNaN(a)?b:a},a.Item.prototype.getItemRank=function(){
return isNaN(this._data.rank)?b:this._data.rank},a.Item.prototype.getCacheKey=a.Item.prototype.getItemId}(R),function(a,b){function c(b){if(b._processed)return b;var c,e,f=a.coalesce(b.shopUrl,b.shopurl,b.shop_url);return b.historydate&&(c=new a.Date(c)),e=d.exec(f),e&&(f=e[1]),{_processed:!0,shopId:a.coalesce(b.shopId,b.shopid,b.shop_id),shopName:a.coalesce(b.shopName,b.shopname,b.shop_name),shopUrl:f,serviceName:a.coalesce(b.servicename,b.serviceName),serviceUrl:b.serviceurl,serviceUrlFull:b.serviceurlfull,
delUrl:b.delurl,shopUrlFull:b.shopurlfull,historyDate:c}}var d=/rakuten.co.jp\/([^\/])\/d/;a.Shop=function(b){b instanceof a.Shop?this._data=b._data:this._data=c(b)},a.Shop.prototype.getShopId=function(){return this._data.shopId},a.Shop.prototype.getShopName=function(){return this._data.shopName},a.Shop.prototype.getShopUrl=function(){return"http://www.rakuten.co.jp/"+this._data.shopUrl+"/"},a.Shop.prototype.getShopLogoUrl=function(a,c,d,e){return this._data.shopUrl?"//thumbnail.image.rakuten.co.jp/@0_mall/"+this._data.shopUrl+"/logo/logo"+a+(c?"n.jpg":".jpg")+(d&&e?"?_ex="+String(d)+"x"+String(e):""):b;
},a.Shop.prototype.getServiceName=function(){return this._data.serviceName},a.Shop.prototype.getDeleteUrl=function(){return this._data.delUrl},a.Shop.prototype.getServiceUrlFull=function(){return this._data.serviceUrlFull},a.Shop.prototype.getServiceUrl=function(){return this._data.serviceUrl},a.Shop.prototype.getShopUrlFull=function(){return this._data.shopUrlFull}}(R),function(a,b){var c=a.$,d="http://counter.order.my.rakuten.co.jp/campaign/";a.api.kaimawari={},a.api.kaimawari.ResponseData=function(b,d){
this._data={count:b,lastDate:new a.Date(d)},this.getShopCount=function(a){var b=c.extend({offset:0,maxShops:1/0},a);return Math.max(0,Math.min(this._data.count,b.maxShops)-b.offset)},this.getLastCheckDate=function(){return this._data.lastDate}},a.api.kaimawari.loadNumberOfShops=function(b){var e,f=c.Deferred(),g=c.extend({mock_id:"KAIMAWARI",retry:2,retry_delay:1e3,retry_factor:2,cache:!0},b);if(!g.startDate||!g.endDate)throw"required options.startDate and options.endDate not set";return g.startDate=new a.Date(g.startDate),
g.endDate=new a.Date(g.endDate),g.currentDate=new a.Date(g.currentDate),g.ignoreDates||g.currentDate.isBetween(g.startDate,g.endDate)?(e=a.extendApiSettings({url:d+"shop_counter.php",data:{buy_type:"s",s:g.startDate.getCalendarFormat(),e:g.endDate.getCalendarFormat()}},g),a.requestData(e).fail(f.reject).done(function(b){b&&"success"===b.status?f.resolve(new a.api.kaimawari.ResponseData(b.count,b.last_date)):f.reject(b)}),f.promise()):(f.resolve(null),f.promise())}}(R),function(a,b){var c=a.$,d="//grp03.api.rp.rakuten.co.jp/geap/v1/ichiba/rcmd/recommend_ichiba.json";
a.api.itemRecommendation={ServiceId:{PC:"00-00-000-210",SP:"00-00-000-212"},Encoding:{UTF_8:"utf-8",EUC_JP:"euc-jp"}},a.api.itemRecommendation.loadUserBasedRecommendedItems=function(b){var e,f=c.Deferred(),g=c.extend({mock_id:"USER_BASED_RECOMMEND",retry:0,timeout:a.isMobile?9e3:3e3,cache:!0},b);if(!g.sid)throw"required options.sid not set";return e=a.extendApiSettings({url:d,data:{sid:g.sid}},g),g.encoding&&(e.data.encoding=g.encoding),g.genre&&(e.data.gid=g.genre),g.itemId&&(e.data.item_id=g.itemId),
g.lid&&(e.data.lid=g.lid),a.requestData(e).fail(f.reject).done(function(b){var c,d,e,g=[];if(!b||"Success"!==b.status&&"NotFound"!==b.status)f.reject(b);else{for(c=0,d=b.item.length;d>c;c++)e=new a.Item(b.item[c]),g.push(e);f.resolve(g)}}),f.promise()}}(R),function(a,b){var c=a.$,d="/com/js/d/deal_ranking/data/DealRanking.json";a.api.deal={},a.api.deal.loadRankingItems=function(e){var f,g=c.Deferred(),h=c.extend({mock_id:"DEAL_RANKING",retry:0,cache:!0},e);return f=a.extendApiSettings({
url:d,data:{sid:h.sid},dataType:"json"},h),a.requestData(f).fail(g.reject).done(function(c,d,e){var f,h,i,j,k=[];if(c&&c.DealRanking){for(f=0,h=c.DealRanking.length;h>f;f++)i=new a.Item(c.DealRanking[f]),k.push(i);j=e&&e.getResponseHeader("last-modified"),j=j?new a.Date(j):b,g.resolve(k,j)}else g.reject(c)}),g.promise()}}(R),function(a,b){var c=a.$,d="//api.premium.rakuten.co.jp/v1.0/isMember",e={};return e.ServiceId={ICHIBA_TOP:2,BASKET:2,PORTAL:3,PORTA_R_DR:4},e.ResponseData=function(a){
this._data={status:a.status,remainingRewardCount:a.remainingRewardCount}},e.ResponseData.prototype.isMember=function(){return 200===this._data.status&&this._data.remainingRewardCount!=b},e.ResponseData.prototype.getRemainingRewardCount=function(){return this._data.remainingRewardCount},e.getMemberDetails=function(b){var e,f,g=c.Deferred();if(!b.sid)throw"options.sid required";return a.user.isLogged()?(f=c.extend({mock_id:"PREMIUM_MEMBER",retry:0,cache:!0},b),e=a.extendApiSettings({url:d,data:{serviceId:f.sid
}},f),a.requestData(e).fail(g.reject).done(function(b){!b||200!==b.status&&404!==b.status?g.reject(b):g.resolve(new a.api.premiumMember.ResponseData(b))}),g.promise()):(g.resolve(new a.api.premiumMember.ResponseData({status:404,remainingRewardCount:0})),g.promise())},a.api.premiumMember=e,a.api.premiumMember}(R),function(a,b){var c=a.$,d="//ichiba-p-rate.api.rakuten.co.jp/spu/jsonp";a.api.spu={ServiceId:a.api.ServiceIds,Source:{PC:"pc",SP:"sp",APP:"app"},ViewType:{DEFAULT:"default",TOP:"top",
CATEGORY:"category",EVENT:"event",ITEM:"item",SHOP:"shop",SEARCH:"search",STEP0:"step0",STEP4:"step4"},UserRank:a.enums.UserRank,Encoding:{UTF_8:"UTF-8",EUC_JP:"EUC-JP"}},a.api.spu.ResponseData=function(c){var d,e;for(this.totalRate=parseFloat(c.totalRate),this.userRank=parseInt(c.userRank,10),this.sections=[],d=0,e=c.sections.length;e>d;d++)this.sections.push(new a.api.spu.SpuSection(c.sections[d]));this.getSection=function(c){var d=a.find(this.sections,function(a){return a.id===c});return-1===d?b:this.sections[d];
},this.getService=function(a){var c,d,e;for(c=0,d=this.sections.length;d>c;c++)if(e=this.sections[c].getService(a))return e;return b},this.getAllServices=function(a){var b,c,d,e,f,g=this.sections.length,h=[];for(b=0;g>b;b++)for(c=this.sections[b],e=c.services.length,d=0;e>d;d++)f=c.services[d],(f.isQualified||a)&&h.push({section:c,service:f});return h},this.getUserRankString=function(){var b=this.userRank,c=a.find(a.api.spu.UserRank,function(a){return a===b});return a.isString(c)?c.toLowerCase():"";
}},a.api.spu.SpuSection=function(c){var d,e;for(this.id=c.id,this.name=c.name,this.totalRate=parseFloat(c.totalRate),this.services=[],d=0,e=c.services.length;e>d;d++)this.services.push(new a.api.spu.SpuSectionService(c.services[d]));this.getService=function(c){var d=a.find(this.services,function(a){return a.id===c});return-1===d?b:this.services[d]}},a.api.spu.SpuSectionService=function(a){this.id=a.id,this.name=a.name,this.rate=parseFloat(a.rate),this.isQualified=a.qualified,this.link=a.link},a.api.spu.loadSpu=function(b){
var e,f=c.Deferred(),g=c.extend({mock_id:"SPU",encoding:a.api.spu.EUC_JP,retry:3,cache:!0},b);if(!g.sid)throw"required options.sid not set";if(!g.source)throw"required options.source not set";if(!g.viewType)throw"required options.viewType not set";return e=a.extendApiSettings({url:d,data:{source:g.source,viewType:g.viewType,acc:g.sid.acc,aid:g.sid.aid,enc:g.encoding}},b),g.userRank&&(e.data.userRank=g.userRank),g.itemId&&(e.data.itemId=g.itemId),g.shopId&&(e.data.shopId=g.shopId),a.requestData(e).fail(f.reject).done(function(b){
return b?void f.resolve(new a.api.spu.ResponseData(b)):void f.reject()}),f.promise()}}(R);

return R.api; });}